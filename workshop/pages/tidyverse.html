<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Wyoming IBC" />
  <meta name="dcterms.date" content="2019-10-07" />
  <title>Flavor of Tidyverse</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="avenir-white.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Flavor of Tidyverse</h1>
<p class="author">Wyoming IBC</p>
<p class="date">October 7, 2019</p>
</header>
<p><a href="../index.html">Return to Main Page</a></p>
<p><br><br></p>
<h2 id="table-of-contents">Table of Contents</h2>
<p><a href="#the-deplyr-package">1 Common Data Manipulation with <code>dplyr</code></a></p>
<p><a href="#the-dataset">1.1 The <code>nycflights13</code> Dataset</a></p>
<p><a href="#the-filter-function">1.2 The <code>filter()</code> Function</a></p>
<p><a href="#exercises">1.2.1 Exercises</a></p>
<p><a href="#the-select-function">1.3 The <code>select()</code> Function</a></p>
<p><a href="#create-new-variables-with-mutate">1.4 Create new variables with <code>mutate()</code></a></p>
<p><a href="#mutate-exercises">1.4.1 Mutate Exercises</a></p>
<hr />
<p><a href="#a-new-grammar-of-graphics-ggplot2">2 A New Grammar of Graphics <code>ggplot2</code></a></p>
<p><a href="#the-mpg-data-set">2.1 The <code>mpg</code> Data Set</a></p>
<p><a href="#a-basic-plot">2.2 A Basic Plot</a></p>
<p><a href="#saving-your-plots">2.3 Saving Your Plots</a></p>
<p><a href="#enhancing-plot-aesthetics">2.4 Enhancing Plot Aesthetics</a></p>
<p><a href="#using-facets">2.5 Using Facets</a></p>
<p><br><br><br><br><br></p>
<h2 id="getting-the-flavor-of-tidyverse">Getting the Flavor of <em>Tidyverse</em></h2>
<p>Tidyverse is a framework that provides complementary R packages for data wrangling, visualization and programming. In this part of the workshop, we will visit a few of these packages and learn some of their functionality by following example data sets. This should useful whether you are a new R user or have experienced with functions available in base-R, the core group of R packages.</p>
<p>Let’s begin by starting R-Studio and loading the tidyverse packages:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">load</span>(tidyverse)</a></code></pre></div>
<p><br><br></p>
<h3 id="the-dplyr-package">1. The dplyr Package</h3>
<p><img src="hex-dplyr.png" width=50></p>
<p>What are common data manipulation needs you might ask? Consider the following:</p>
<ol type="1">
<li><p>Filter large data sets using multiple variables to suit your analysis</p></li>
<li><p>Reorder the rows of a very large spreadsheet so the ones you are interested in are at the top</p></li>
<li><p>Select only those columns for analysis that you need from numerous available</p></li>
<li><p>Create new variables on the fly by manipulating existing ones</p></li>
</ol>
<p>deplyr provides functions (called ‘verbs’ here) that cater to each of these needs. We will use the <code>nycflights13</code> data set to understand these verbs.</p>
<p><br><br></p>
<h4 id="the-nycflights13-dataset">1.1 The nycflights13 Dataset</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">install.packages</span>(<span class="st">&#39;nycflights13&#39;</span>)</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">library</span>(nycflights13)</a></code></pre></div>
<p>This data set contains over 330,000 flights that arrived or departed from New York City in 2013. It’s a very large data frame consisting of 19 columns and 336,776 rows. Run a quick overview of the data set as follows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"></a>
<a class="sourceLine" id="cb3-2" title="2">flights</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co"># A tibble: 336,776 x 19</span></a>
<a class="sourceLine" id="cb3-5" title="5">    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</a>
<a class="sourceLine" id="cb3-6" title="6">   <span class="op">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">          </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">          </span><span class="er">&lt;</span>int<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="st"> </span><span class="dv">1</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">517</span>            <span class="dv">515</span>         <span class="dv">2</span>      <span class="dv">830</span>            <span class="dv">819</span></a>
<a class="sourceLine" id="cb3-8" title="8"> <span class="dv">2</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">533</span>            <span class="dv">529</span>         <span class="dv">4</span>      <span class="dv">850</span>            <span class="dv">830</span></a>
<a class="sourceLine" id="cb3-9" title="9"> <span class="dv">3</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">542</span>            <span class="dv">540</span>         <span class="dv">2</span>      <span class="dv">923</span>            <span class="dv">850</span></a>
<a class="sourceLine" id="cb3-10" title="10"> <span class="dv">4</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">544</span>            <span class="dv">545</span>        <span class="dv">-1</span>     <span class="dv">1004</span>           <span class="dv">1022</span></a>
<a class="sourceLine" id="cb3-11" title="11"> <span class="dv">5</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">554</span>            <span class="dv">600</span>        <span class="dv">-6</span>      <span class="dv">812</span>            <span class="dv">837</span></a>
<a class="sourceLine" id="cb3-12" title="12"> <span class="dv">6</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">554</span>            <span class="dv">558</span>        <span class="dv">-4</span>      <span class="dv">740</span>            <span class="dv">728</span></a>
<a class="sourceLine" id="cb3-13" title="13"> <span class="dv">7</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">555</span>            <span class="dv">600</span>        <span class="dv">-5</span>      <span class="dv">913</span>            <span class="dv">854</span></a>
<a class="sourceLine" id="cb3-14" title="14"> <span class="dv">8</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">557</span>            <span class="dv">600</span>        <span class="dv">-3</span>      <span class="dv">709</span>            <span class="dv">723</span></a>
<a class="sourceLine" id="cb3-15" title="15"> <span class="dv">9</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">557</span>            <span class="dv">600</span>        <span class="dv">-3</span>      <span class="dv">838</span>            <span class="dv">846</span></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="dv">10</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">558</span>            <span class="dv">600</span>        <span class="dv">-2</span>      <span class="dv">753</span>            <span class="dv">745</span></a>
<a class="sourceLine" id="cb3-17" title="17"><span class="co"># … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="co">#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb3-19" title="19"><span class="co">#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></a></code></pre></div>
<p>If you are familiar with the concept of data frames in R, you were probably cringing while typing <code>flights</code> at the prompt. This is because invoking an entire data frame in R usually prints about 10,000 lines to the screen before it stops.</p>
<p>The <code>flights</code> object here, although also a data frame, is one of a special type called <code>tibble</code>. The tibbles are a feature of the tidyverse. In fact <code>tibbles</code> is a tidy package which reimagines the classical data frame so as to not overwhelm your R client. It only prints basic information about the data set. Any data frame can be converted to a tibble.</p>
<p>Note under each column name, there is an italicized abbreviation which tells you what type of data that column contains:</p>
<ul>
<li><code>int</code> are integers</li>
<li><code>dbl</code> are real numbers</li>
<li><code>chr</code> are character vectors or strings</li>
<li><code>dttm</code> represents date time</li>
</ul>
<p><br><br></p>
<h3 id="the-filter-function">1.2 The <code>filter()</code> Function</h3>
<p>Imagine you want to find out flights that arrived and departed on a specific day of the year. Thus we have two variables at play here:</p>
<ul>
<li><code>month</code></li>
<li><code>day of the month</code></li>
</ul>
<p>Both are coded as numerical data in this tibble. The <code>filter()</code> function requires at least two arguments:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">filter</span>(NAME_OF_TIBBLE, FILTERING_CONDITION1)</a></code></pre></div>
<p>Let’s say we want to find out everything about the flights that arrived/departed on Christmas day in 2013. So you’d do:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"></a>
<a class="sourceLine" id="cb5-2" title="2">xmas &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">12</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">25</span>)</a>
<a class="sourceLine" id="cb5-3" title="3"></a></code></pre></div>
<p>Note how this doesn’t return any information to the screen. That’s because we sent the output of our command to a new variable called <code>xmas</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"></a>
<a class="sourceLine" id="cb6-2" title="2">xmas</a>
<a class="sourceLine" id="cb6-3" title="3"></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co"># A tibble: 719 x 19</span></a>
<a class="sourceLine" id="cb6-5" title="5">    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</a>
<a class="sourceLine" id="cb6-6" title="6">   <span class="op">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">          </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">          </span><span class="er">&lt;</span>int<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="st"> </span><span class="dv">1</span>  <span class="dv">2013</span>    <span class="dv">12</span>    <span class="dv">25</span>      <span class="dv">456</span>            <span class="dv">500</span>        <span class="dv">-4</span>      <span class="dv">649</span>            <span class="dv">651</span></a>
<a class="sourceLine" id="cb6-8" title="8"> <span class="dv">2</span>  <span class="dv">2013</span>    <span class="dv">12</span>    <span class="dv">25</span>      <span class="dv">524</span>            <span class="dv">515</span>         <span class="dv">9</span>      <span class="dv">805</span>            <span class="dv">814</span></a>
<a class="sourceLine" id="cb6-9" title="9"> <span class="dv">3</span>  <span class="dv">2013</span>    <span class="dv">12</span>    <span class="dv">25</span>      <span class="dv">542</span>            <span class="dv">540</span>         <span class="dv">2</span>      <span class="dv">832</span>            <span class="dv">850</span></a>
<a class="sourceLine" id="cb6-10" title="10"> <span class="dv">4</span>  <span class="dv">2013</span>    <span class="dv">12</span>    <span class="dv">25</span>      <span class="dv">546</span>            <span class="dv">550</span>        <span class="dv">-4</span>     <span class="dv">1022</span>           <span class="dv">1027</span></a>
<a class="sourceLine" id="cb6-11" title="11"> <span class="dv">5</span>  <span class="dv">2013</span>    <span class="dv">12</span>    <span class="dv">25</span>      <span class="dv">556</span>            <span class="dv">600</span>        <span class="dv">-4</span>      <span class="dv">730</span>            <span class="dv">745</span></a>
<a class="sourceLine" id="cb6-12" title="12"> <span class="dv">6</span>  <span class="dv">2013</span>    <span class="dv">12</span>    <span class="dv">25</span>      <span class="dv">557</span>            <span class="dv">600</span>        <span class="dv">-3</span>      <span class="dv">743</span>            <span class="dv">752</span></a>
<a class="sourceLine" id="cb6-13" title="13"> <span class="dv">7</span>  <span class="dv">2013</span>    <span class="dv">12</span>    <span class="dv">25</span>      <span class="dv">557</span>            <span class="dv">600</span>        <span class="dv">-3</span>      <span class="dv">818</span>            <span class="dv">831</span></a>
<a class="sourceLine" id="cb6-14" title="14"> <span class="dv">8</span>  <span class="dv">2013</span>    <span class="dv">12</span>    <span class="dv">25</span>      <span class="dv">559</span>            <span class="dv">600</span>        <span class="dv">-1</span>      <span class="dv">855</span>            <span class="dv">856</span></a>
<a class="sourceLine" id="cb6-15" title="15"> <span class="dv">9</span>  <span class="dv">2013</span>    <span class="dv">12</span>    <span class="dv">25</span>      <span class="dv">559</span>            <span class="dv">600</span>        <span class="dv">-1</span>      <span class="dv">849</span>            <span class="dv">855</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="dv">10</span>  <span class="dv">2013</span>    <span class="dv">12</span>    <span class="dv">25</span>      <span class="dv">600</span>            <span class="dv">600</span>         <span class="dv">0</span>      <span class="dv">850</span>            <span class="dv">846</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="co"># … with 709 more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co">#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb6-19" title="19"><span class="co">#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></a>
<a class="sourceLine" id="cb6-20" title="20"></a>
<a class="sourceLine" id="cb6-21" title="21"></a></code></pre></div>
<p>Consider the number of observations here (n=719). That’s how many flights arrived/departed from New York City on that day. Essentially what you have done here is subsetted your data frame using two conditions.</p>
<p>This was a trivial example, but in real world situations, queries can get pretty complicated. Let’s make it a tiny bit more complicated. How about filtering the rows based on flights from two different months: April and August:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"></a>
<a class="sourceLine" id="cb7-2" title="2">AprAug &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">8</span>))</a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4">AprAug</a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co"># A tibble: 57,657 x 19</span></a>
<a class="sourceLine" id="cb7-8" title="8">    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</a>
<a class="sourceLine" id="cb7-9" title="9">   <span class="op">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">          </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">          </span><span class="er">&lt;</span>int<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="st"> </span><span class="dv">1</span>  <span class="dv">2013</span>     <span class="dv">4</span>     <span class="dv">1</span>      <span class="dv">454</span>            <span class="dv">500</span>        <span class="dv">-6</span>      <span class="dv">636</span>            <span class="dv">640</span></a>
<a class="sourceLine" id="cb7-11" title="11"> <span class="dv">2</span>  <span class="dv">2013</span>     <span class="dv">4</span>     <span class="dv">1</span>      <span class="dv">509</span>            <span class="dv">515</span>        <span class="dv">-6</span>      <span class="dv">743</span>            <span class="dv">814</span></a>
<a class="sourceLine" id="cb7-12" title="12"> <span class="dv">3</span>  <span class="dv">2013</span>     <span class="dv">4</span>     <span class="dv">1</span>      <span class="dv">526</span>            <span class="dv">530</span>        <span class="dv">-4</span>      <span class="dv">812</span>            <span class="dv">827</span></a>
<a class="sourceLine" id="cb7-13" title="13"> <span class="dv">4</span>  <span class="dv">2013</span>     <span class="dv">4</span>     <span class="dv">1</span>      <span class="dv">534</span>            <span class="dv">540</span>        <span class="dv">-6</span>      <span class="dv">833</span>            <span class="dv">850</span></a>
<a class="sourceLine" id="cb7-14" title="14"> <span class="dv">5</span>  <span class="dv">2013</span>     <span class="dv">4</span>     <span class="dv">1</span>      <span class="dv">542</span>            <span class="dv">545</span>        <span class="dv">-3</span>      <span class="dv">914</span>            <span class="dv">920</span></a>
<a class="sourceLine" id="cb7-15" title="15"> <span class="dv">6</span>  <span class="dv">2013</span>     <span class="dv">4</span>     <span class="dv">1</span>      <span class="dv">543</span>            <span class="dv">545</span>        <span class="dv">-2</span>      <span class="dv">921</span>            <span class="dv">927</span></a>
<a class="sourceLine" id="cb7-16" title="16"> <span class="dv">7</span>  <span class="dv">2013</span>     <span class="dv">4</span>     <span class="dv">1</span>      <span class="dv">551</span>            <span class="dv">600</span>        <span class="dv">-9</span>      <span class="dv">748</span>            <span class="dv">659</span></a>
<a class="sourceLine" id="cb7-17" title="17"> <span class="dv">8</span>  <span class="dv">2013</span>     <span class="dv">4</span>     <span class="dv">1</span>      <span class="dv">552</span>            <span class="dv">600</span>        <span class="dv">-8</span>      <span class="dv">641</span>            <span class="dv">701</span></a>
<a class="sourceLine" id="cb7-18" title="18"> <span class="dv">9</span>  <span class="dv">2013</span>     <span class="dv">4</span>     <span class="dv">1</span>      <span class="dv">553</span>            <span class="dv">600</span>        <span class="dv">-7</span>      <span class="dv">725</span>            <span class="dv">735</span></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="dv">10</span>  <span class="dv">2013</span>     <span class="dv">4</span>     <span class="dv">1</span>      <span class="dv">554</span>            <span class="dv">600</span>        <span class="dv">-6</span>      <span class="dv">752</span>            <span class="dv">805</span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="co"># … with 57,647 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="co">#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="co">#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></a></code></pre></div>
<p>During those two months, nearly 58000 flights operated out of New York City.</p>
<p>Here is another example:</p>
<p>Let’s find flights that neither arrived nor departed more than 30 mins late. The variables in play here are:</p>
<ul>
<li><code>arr_delay</code></li>
<li><code>dep_delay</code></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"></a>
<a class="sourceLine" id="cb8-2" title="2">late30 &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, arr_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span>, dep_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span>)</a></code></pre></div>
<p><br></p>
<h4 id="exercises">1.2.1 Exercises</h4>
<ol type="1">
<li><p>Filter the number of flights that went to San Francisco (SFO) in February 2013.</p></li>
<li><p>Find flights that arrived at least 2 hours late</p></li>
<li><p>Filter flights operated by United Airlines in the months of November and December 2013</p></li>
<li><p>Among the three major airlines (United, American and Delta), which operated the most flights during sumemr months (July through August)</p></li>
</ol>
<p><br><br></p>
<h3 id="the-select-function">1.3 The <code>select()</code> Function</h3>
<p>This function allows selecting on columns of interest. With the <code>nycflights13</code> data set, we only have 19 columns, but big data sets often have hundreds if not thousands of columns. To be able to subset such large data sets for only a few columns could be very useful. Let’s look at a few examples:</p>
<ul>
<li>First, if you want to check what all columns are present in the <code>flights</code> tibble, you can do this:</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">names</span>(flights)</a>
<a class="sourceLine" id="cb9-3" title="3"></a>
<a class="sourceLine" id="cb9-4" title="4"> [<span class="dv">1</span>] <span class="st">&quot;year&quot;</span>           <span class="st">&quot;month&quot;</span>          <span class="st">&quot;day&quot;</span>            <span class="st">&quot;dep_time&quot;</span>      </a>
<a class="sourceLine" id="cb9-5" title="5"> [<span class="dv">5</span>] <span class="st">&quot;sched_dep_time&quot;</span> <span class="st">&quot;dep_delay&quot;</span>      <span class="st">&quot;arr_time&quot;</span>       <span class="st">&quot;sched_arr_time&quot;</span></a>
<a class="sourceLine" id="cb9-6" title="6"> [<span class="dv">9</span>] <span class="st">&quot;arr_delay&quot;</span>      <span class="st">&quot;carrier&quot;</span>        <span class="st">&quot;flight&quot;</span>         <span class="st">&quot;tailnum&quot;</span>       </a>
<a class="sourceLine" id="cb9-7" title="7">[<span class="dv">13</span>] <span class="st">&quot;origin&quot;</span>         <span class="st">&quot;dest&quot;</span>           <span class="st">&quot;air_time&quot;</span>       <span class="st">&quot;distance&quot;</span>      </a>
<a class="sourceLine" id="cb9-8" title="8">[<span class="dv">17</span>] <span class="st">&quot;hour&quot;</span>           <span class="st">&quot;minute&quot;</span>         <span class="st">&quot;time_hour&quot;</span>     </a></code></pre></div>
<ul>
<li><p>Now consider that you are interested in the following data:</p>
<ul>
<li><code>month</code></li>
<li><code>carrier</code></li>
<li><code>distance</code></li>
</ul></li>
</ul>
<p>Here is how you’d subset the data:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"></a>
<a class="sourceLine" id="cb10-2" title="2">flights_sub1 &lt;-<span class="st"> </span><span class="kw">select</span>(flights, month, carrier, distance)</a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4">flights_sub1</a>
<a class="sourceLine" id="cb10-5" title="5"></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co"># A tibble: 336,776 x 3</span></a>
<a class="sourceLine" id="cb10-7" title="7">   month carrier distance</a>
<a class="sourceLine" id="cb10-8" title="8">   <span class="op">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">      </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="st"> </span><span class="dv">1</span>     <span class="dv">1</span> UA          <span class="dv">1400</span></a>
<a class="sourceLine" id="cb10-10" title="10"> <span class="dv">2</span>     <span class="dv">1</span> UA          <span class="dv">1416</span></a>
<a class="sourceLine" id="cb10-11" title="11"> <span class="dv">3</span>     <span class="dv">1</span> AA          <span class="dv">1089</span></a>
<a class="sourceLine" id="cb10-12" title="12"> <span class="dv">4</span>     <span class="dv">1</span> B6          <span class="dv">1576</span></a>
<a class="sourceLine" id="cb10-13" title="13"> <span class="dv">5</span>     <span class="dv">1</span> DL           <span class="dv">762</span></a>
<a class="sourceLine" id="cb10-14" title="14"> <span class="dv">6</span>     <span class="dv">1</span> UA           <span class="dv">719</span></a>
<a class="sourceLine" id="cb10-15" title="15"> <span class="dv">7</span>     <span class="dv">1</span> B6          <span class="dv">1065</span></a>
<a class="sourceLine" id="cb10-16" title="16"> <span class="dv">8</span>     <span class="dv">1</span> EV           <span class="dv">229</span></a>
<a class="sourceLine" id="cb10-17" title="17"> <span class="dv">9</span>     <span class="dv">1</span> B6           <span class="dv">944</span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="dv">10</span>     <span class="dv">1</span> AA           <span class="dv">733</span></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="co"># … with 336,766 more rows</span></a>
<a class="sourceLine" id="cb10-20" title="20"></a></code></pre></div>
<p>Note that unlike <code>filter()</code>, we are not actually subsetting the data in rows. All rows are present in the subset. It’s just that now have only 3 columns in the subset as we needed.</p>
<ul>
<li>You can also select multiple columns if they appear in order. For example, <code>year</code>, <code>month</code>, and <code>day</code> appear consecutively. You could select for them as follows:</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"></a>
<a class="sourceLine" id="cb11-2" title="2">flights_sub2 &lt;-<span class="st"> </span><span class="kw">select</span>(flights, year<span class="op">:</span>day)</a>
<a class="sourceLine" id="cb11-3" title="3"></a>
<a class="sourceLine" id="cb11-4" title="4">flights_sub2</a>
<a class="sourceLine" id="cb11-5" title="5"></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co"># A tibble: 336,776 x 3</span></a>
<a class="sourceLine" id="cb11-7" title="7">    year month   day</a>
<a class="sourceLine" id="cb11-8" title="8">   <span class="op">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="st"> </span><span class="dv">1</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span></a>
<a class="sourceLine" id="cb11-10" title="10"> <span class="dv">2</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span></a>
<a class="sourceLine" id="cb11-11" title="11"> <span class="dv">3</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span></a>
<a class="sourceLine" id="cb11-12" title="12"> <span class="dv">4</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span></a>
<a class="sourceLine" id="cb11-13" title="13"> <span class="dv">5</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span></a>
<a class="sourceLine" id="cb11-14" title="14"> <span class="dv">6</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span></a>
<a class="sourceLine" id="cb11-15" title="15"> <span class="dv">7</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span></a>
<a class="sourceLine" id="cb11-16" title="16"> <span class="dv">8</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span></a>
<a class="sourceLine" id="cb11-17" title="17"> <span class="dv">9</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="dv">10</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span></a>
<a class="sourceLine" id="cb11-19" title="19"><span class="co"># … with 336,766 more rows</span></a></code></pre></div>
<ul>
<li>You can also use the same method to select all columns other than the ones mentioned.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"></a>
<a class="sourceLine" id="cb12-2" title="2">flights_sub3 &lt;-<span class="st"> </span><span class="kw">select</span>(flights, <span class="op">-</span>(year<span class="op">:</span>day))</a>
<a class="sourceLine" id="cb12-3" title="3"></a>
<a class="sourceLine" id="cb12-4" title="4">flights_sub3</a>
<a class="sourceLine" id="cb12-5" title="5"></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co"># A tibble: 336,776 x 16</span></a>
<a class="sourceLine" id="cb12-7" title="7">   dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier</a>
<a class="sourceLine" id="cb12-8" title="8">      <span class="op">&lt;</span>int<span class="op">&gt;</span><span class="st">          </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">          </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">  </span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="st"> </span><span class="dv">1</span>      <span class="dv">517</span>            <span class="dv">515</span>         <span class="dv">2</span>      <span class="dv">830</span>            <span class="dv">819</span>        <span class="dv">11</span> UA     </a>
<a class="sourceLine" id="cb12-10" title="10"> <span class="dv">2</span>      <span class="dv">533</span>            <span class="dv">529</span>         <span class="dv">4</span>      <span class="dv">850</span>            <span class="dv">830</span>        <span class="dv">20</span> UA     </a>
<a class="sourceLine" id="cb12-11" title="11"> <span class="dv">3</span>      <span class="dv">542</span>            <span class="dv">540</span>         <span class="dv">2</span>      <span class="dv">923</span>            <span class="dv">850</span>        <span class="dv">33</span> AA     </a>
<a class="sourceLine" id="cb12-12" title="12"> <span class="dv">4</span>      <span class="dv">544</span>            <span class="dv">545</span>        <span class="dv">-1</span>     <span class="dv">1004</span>           <span class="dv">1022</span>       <span class="dv">-18</span> B6     </a>
<a class="sourceLine" id="cb12-13" title="13"> <span class="dv">5</span>      <span class="dv">554</span>            <span class="dv">600</span>        <span class="dv">-6</span>      <span class="dv">812</span>            <span class="dv">837</span>       <span class="dv">-25</span> DL     </a>
<a class="sourceLine" id="cb12-14" title="14"> <span class="dv">6</span>      <span class="dv">554</span>            <span class="dv">558</span>        <span class="dv">-4</span>      <span class="dv">740</span>            <span class="dv">728</span>        <span class="dv">12</span> UA     </a>
<a class="sourceLine" id="cb12-15" title="15"> <span class="dv">7</span>      <span class="dv">555</span>            <span class="dv">600</span>        <span class="dv">-5</span>      <span class="dv">913</span>            <span class="dv">854</span>        <span class="dv">19</span> B6     </a>
<a class="sourceLine" id="cb12-16" title="16"> <span class="dv">8</span>      <span class="dv">557</span>            <span class="dv">600</span>        <span class="dv">-3</span>      <span class="dv">709</span>            <span class="dv">723</span>       <span class="dv">-14</span> EV     </a>
<a class="sourceLine" id="cb12-17" title="17"> <span class="dv">9</span>      <span class="dv">557</span>            <span class="dv">600</span>        <span class="dv">-3</span>      <span class="dv">838</span>            <span class="dv">846</span>        <span class="dv">-8</span> B6     </a>
<a class="sourceLine" id="cb12-18" title="18"><span class="dv">10</span>      <span class="dv">558</span>            <span class="dv">600</span>        <span class="dv">-2</span>      <span class="dv">753</span>            <span class="dv">745</span>         <span class="dv">8</span> AA     </a>
<a class="sourceLine" id="cb12-19" title="19"><span class="co"># … with 336,766 more rows, and 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb12-20" title="20"><span class="co">#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb12-21" title="21"><span class="co">#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></a></code></pre></div>
<p><br><br></p>
<h3 id="create-new-variables-with-mutate">1.4 Create New Variables with <code>mutate()</code></h3>
<p>The <code>mutate()</code> function allows you to create new variables on the fly. For example, consider that you wish to find all flights that were delayed and simultaneously you wish to calculate the air speed of those flights. What variables might you need for this?</p>
<ul>
<li><code>year</code>, <code>month</code>, <code>day</code></li>
<li>Delay information; so any columns ending in <code>delay</code></li>
<li>And you need <code>distance</code> and <code>air_time</code> to calculate the speed.</li>
</ul>
<p>First, use the <code>select()</code> function to subset the flights tibble with the above info.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"></a>
<a class="sourceLine" id="cb13-2" title="2">flights_sml &lt;-<span class="st"> </span><span class="kw">select</span>(flights, year<span class="op">:</span>day, <span class="kw">ends_with</span>(<span class="st">&quot;delay&quot;</span>), distance, air_time)</a>
<a class="sourceLine" id="cb13-3" title="3"></a>
<a class="sourceLine" id="cb13-4" title="4">flights_sml</a>
<a class="sourceLine" id="cb13-5" title="5"></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="co"># A tibble: 336,776 x 7</span></a>
<a class="sourceLine" id="cb13-7" title="7">    year month   day dep_delay arr_delay distance air_time</a>
<a class="sourceLine" id="cb13-8" title="8">   <span class="op">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="st"> </span><span class="dv">1</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>         <span class="dv">2</span>        <span class="dv">11</span>     <span class="dv">1400</span>      <span class="dv">227</span></a>
<a class="sourceLine" id="cb13-10" title="10"> <span class="dv">2</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>         <span class="dv">4</span>        <span class="dv">20</span>     <span class="dv">1416</span>      <span class="dv">227</span></a>
<a class="sourceLine" id="cb13-11" title="11"> <span class="dv">3</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>         <span class="dv">2</span>        <span class="dv">33</span>     <span class="dv">1089</span>      <span class="dv">160</span></a>
<a class="sourceLine" id="cb13-12" title="12"> <span class="dv">4</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>        <span class="dv">-1</span>       <span class="dv">-18</span>     <span class="dv">1576</span>      <span class="dv">183</span></a>
<a class="sourceLine" id="cb13-13" title="13"> <span class="dv">5</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>        <span class="dv">-6</span>       <span class="dv">-25</span>      <span class="dv">762</span>      <span class="dv">116</span></a>
<a class="sourceLine" id="cb13-14" title="14"> <span class="dv">6</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>        <span class="dv">-4</span>        <span class="dv">12</span>      <span class="dv">719</span>      <span class="dv">150</span></a>
<a class="sourceLine" id="cb13-15" title="15"> <span class="dv">7</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>        <span class="dv">-5</span>        <span class="dv">19</span>     <span class="dv">1065</span>      <span class="dv">158</span></a>
<a class="sourceLine" id="cb13-16" title="16"> <span class="dv">8</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>        <span class="dv">-3</span>       <span class="dv">-14</span>      <span class="dv">229</span>       <span class="dv">53</span></a>
<a class="sourceLine" id="cb13-17" title="17"> <span class="dv">9</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>        <span class="dv">-3</span>        <span class="dv">-8</span>      <span class="dv">944</span>      <span class="dv">140</span></a>
<a class="sourceLine" id="cb13-18" title="18"><span class="dv">10</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>        <span class="dv">-2</span>         <span class="dv">8</span>      <span class="dv">733</span>      <span class="dv">138</span></a>
<a class="sourceLine" id="cb13-19" title="19"><span class="co"># … with 336,766 more rows</span></a>
<a class="sourceLine" id="cb13-20" title="20"></a></code></pre></div>
<ul>
<li>Now you can use <code>mutate()</code> to calculate the speed as follows:</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"></a>
<a class="sourceLine" id="cb14-2" title="2">flights_spd &lt;-<span class="st"> </span><span class="kw">mutate</span>(flights_sml, </a>
<a class="sourceLine" id="cb14-3" title="3">        <span class="dt">speed =</span> distance <span class="op">/</span><span class="st"> </span>air_time <span class="op">*</span><span class="st"> </span><span class="dv">60</span>)</a>
<a class="sourceLine" id="cb14-4" title="4"></a>
<a class="sourceLine" id="cb14-5" title="5"></a>
<a class="sourceLine" id="cb14-6" title="6">flights_spd</a>
<a class="sourceLine" id="cb14-7" title="7"></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="co"># A tibble: 336,776 x 8</span></a>
<a class="sourceLine" id="cb14-9" title="9">    year month   day dep_delay arr_delay distance air_time speed</a>
<a class="sourceLine" id="cb14-10" title="10">   <span class="op">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="st"> </span><span class="dv">1</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>         <span class="dv">2</span>        <span class="dv">11</span>     <span class="dv">1400</span>      <span class="dv">227</span>  <span class="fl">370.</span></a>
<a class="sourceLine" id="cb14-12" title="12"> <span class="dv">2</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>         <span class="dv">4</span>        <span class="dv">20</span>     <span class="dv">1416</span>      <span class="dv">227</span>  <span class="fl">374.</span></a>
<a class="sourceLine" id="cb14-13" title="13"> <span class="dv">3</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>         <span class="dv">2</span>        <span class="dv">33</span>     <span class="dv">1089</span>      <span class="dv">160</span>  <span class="fl">408.</span></a>
<a class="sourceLine" id="cb14-14" title="14"> <span class="dv">4</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>        <span class="dv">-1</span>       <span class="dv">-18</span>     <span class="dv">1576</span>      <span class="dv">183</span>  <span class="fl">517.</span></a>
<a class="sourceLine" id="cb14-15" title="15"> <span class="dv">5</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>        <span class="dv">-6</span>       <span class="dv">-25</span>      <span class="dv">762</span>      <span class="dv">116</span>  <span class="fl">394.</span></a>
<a class="sourceLine" id="cb14-16" title="16"> <span class="dv">6</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>        <span class="dv">-4</span>        <span class="dv">12</span>      <span class="dv">719</span>      <span class="dv">150</span>  <span class="fl">288.</span></a>
<a class="sourceLine" id="cb14-17" title="17"> <span class="dv">7</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>        <span class="dv">-5</span>        <span class="dv">19</span>     <span class="dv">1065</span>      <span class="dv">158</span>  <span class="fl">404.</span></a>
<a class="sourceLine" id="cb14-18" title="18"> <span class="dv">8</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>        <span class="dv">-3</span>       <span class="dv">-14</span>      <span class="dv">229</span>       <span class="dv">53</span>  <span class="fl">259.</span></a>
<a class="sourceLine" id="cb14-19" title="19"> <span class="dv">9</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>        <span class="dv">-3</span>        <span class="dv">-8</span>      <span class="dv">944</span>      <span class="dv">140</span>  <span class="fl">405.</span></a>
<a class="sourceLine" id="cb14-20" title="20"><span class="dv">10</span>  <span class="dv">2013</span>     <span class="dv">1</span>     <span class="dv">1</span>        <span class="dv">-2</span>         <span class="dv">8</span>      <span class="dv">733</span>      <span class="dv">138</span>  <span class="fl">319.</span></a>
<a class="sourceLine" id="cb14-21" title="21"><span class="co"># … with 336,766 more rows</span></a>
<a class="sourceLine" id="cb14-22" title="22"></a></code></pre></div>
<p>Notice the new column <code>speed</code> which appears in the newly created tibble. The <code>mutate()</code> function added that column to show us the speed of each flight.</p>
<p><br><br></p>
<h3 id="mutate-exercises">1.4.1 Mutate Exercises</h3>
<ol type="1">
<li><p>Subset the <code>flights</code> tibble to include following columns: <code>carrier</code>, <code>arr_delay</code>, <code>dep_delay</code></p></li>
<li><p>Use <code>mutate()</code> to create a new variable called <code>ground_time</code> by adding the two delay columns</p></li>
<li><p>Then use <code>filter()</code> to calculate the number of flights for each of the 3 major airlines (United, American, Delta) where the <code>ground_time</code> was at least 2 hours.</p></li>
</ol>
<p><br><br><br><br></p>
<h2 id="a-new-grammar-of-graphics-ggplot2">2. A New Grammar of Graphics <code>ggplot2</code></h2>
<p><img src="hex-ggplot2.png" width=50></img></p>
<p>A very common complaint about plots made with base-R graphics is their blandness. The basic plots are always drawn in black and white and with ugly fonts. You can certainly customize them but that makes for more work. When Hadley Wickham first came out with <code>ggplot2</code> as a new grammar of plotting, quickly became very popular. Granted, it has a learning curve similar to learning a new language, but once you get past that initial discomfort, the default plots are publication quality.</p>
<p>In this section, we will use a data set that is routinely used in demonstrating the capabilities of ggplot2 called <code>mpg</code>. The dataset lists fuel efficiencies of various makes of vehicles with varying features. Let’s take a quick look at the data set:</p>
<p><br><br></p>
<h3 id="the-mpg-data-set">2.1 The <code>mpg</code> data set</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"></a>
<a class="sourceLine" id="cb15-2" title="2">mpg</a>
<a class="sourceLine" id="cb15-3" title="3"></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="co"># A tibble: 234 x 11</span></a>
<a class="sourceLine" id="cb15-5" title="5">   manufacturer model    displ  year   cyl trans   drv     cty   hwy fl    class</a>
<a class="sourceLine" id="cb15-6" title="6">   <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">        </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="st"> </span><span class="dv">1</span> audi         a4         <span class="fl">1.8</span>  <span class="dv">1999</span>     <span class="dv">4</span> <span class="kw">auto</span>(l… f        <span class="dv">18</span>    <span class="dv">29</span> p     comp…</a>
<a class="sourceLine" id="cb15-8" title="8"> <span class="dv">2</span> audi         a4         <span class="fl">1.8</span>  <span class="dv">1999</span>     <span class="dv">4</span> manual… f        <span class="dv">21</span>    <span class="dv">29</span> p     comp…</a>
<a class="sourceLine" id="cb15-9" title="9"> <span class="dv">3</span> audi         a4         <span class="dv">2</span>    <span class="dv">2008</span>     <span class="dv">4</span> manual… f        <span class="dv">20</span>    <span class="dv">31</span> p     comp…</a>
<a class="sourceLine" id="cb15-10" title="10"> <span class="dv">4</span> audi         a4         <span class="dv">2</span>    <span class="dv">2008</span>     <span class="dv">4</span> <span class="kw">auto</span>(a… f        <span class="dv">21</span>    <span class="dv">30</span> p     comp…</a>
<a class="sourceLine" id="cb15-11" title="11"> <span class="dv">5</span> audi         a4         <span class="fl">2.8</span>  <span class="dv">1999</span>     <span class="dv">6</span> <span class="kw">auto</span>(l… f        <span class="dv">16</span>    <span class="dv">26</span> p     comp…</a>
<a class="sourceLine" id="cb15-12" title="12"> <span class="dv">6</span> audi         a4         <span class="fl">2.8</span>  <span class="dv">1999</span>     <span class="dv">6</span> manual… f        <span class="dv">18</span>    <span class="dv">26</span> p     comp…</a>
<a class="sourceLine" id="cb15-13" title="13"> <span class="dv">7</span> audi         a4         <span class="fl">3.1</span>  <span class="dv">2008</span>     <span class="dv">6</span> <span class="kw">auto</span>(a… f        <span class="dv">18</span>    <span class="dv">27</span> p     comp…</a>
<a class="sourceLine" id="cb15-14" title="14"> <span class="dv">8</span> audi         a4 quat…   <span class="fl">1.8</span>  <span class="dv">1999</span>     <span class="dv">4</span> manual… <span class="dv">4</span>        <span class="dv">18</span>    <span class="dv">26</span> p     comp…</a>
<a class="sourceLine" id="cb15-15" title="15"> <span class="dv">9</span> audi         a4 quat…   <span class="fl">1.8</span>  <span class="dv">1999</span>     <span class="dv">4</span> <span class="kw">auto</span>(l… <span class="dv">4</span>        <span class="dv">16</span>    <span class="dv">25</span> p     comp…</a>
<a class="sourceLine" id="cb15-16" title="16"><span class="dv">10</span> audi         a4 quat…   <span class="dv">2</span>    <span class="dv">2008</span>     <span class="dv">4</span> manual… <span class="dv">4</span>        <span class="dv">20</span>    <span class="dv">28</span> p     comp…</a>
<a class="sourceLine" id="cb15-17" title="17"><span class="co"># … with 224 more rows</span></a>
<a class="sourceLine" id="cb15-18" title="18"></a></code></pre></div>
<p>Compared to the <code>nycflights13</code> data set we used earlier, this is a pretty small tibble with 234 rows and 11 columns. Consider two variables from the tibble:</p>
<ul>
<li><code>displ</code> is displacement i.e. the size of the engine, and</li>
<li><code>hwy</code> is highway mileage</li>
</ul>
<p>We can visualize relationship between these two variables to compare the fuel efficiency of all makes and models.</p>
<p><code>ggplot2</code> plots are built in stages, one layer at a time. Try the following code and see what you get.</p>
<p><br><br></p>
<h3 id="a-basic-plot">2.2 A basic plot</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="kw">ggplot</span>(<span class="dt">data=</span>mpg)</a></code></pre></div>
<p>The reason your plot is empty because we haven’t told R which variables are to be plotted. That would make the second layer of the plot as follows:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="kw">ggplot</span>(<span class="dt">data=</span>mpg) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</a></code></pre></div>
<center>
<img src="mpg1.png" width=550>
</center>
<p>The <code>geom_point</code> is a function in ggplot2 to make a scatterplot. Ggplot provides a number of geom functions to plot lines (<code>geom_line</code>), histograms (<code>geom_hist</code>), barplots (<code>geom_bar</code>) etc. For more details, visit the <a href="https://ggplot2.tidyverse.org/reference/">ggplot2 reference</a>.</p>
<p>Before we move on, can you try making a scatterplot of highway mileage <em>vs</em> the number of combustion cylinders? What can you say about the relationship of these two variables?</p>
<p><br><br></p>
<h3 id="saving-your-plots">2.3 Saving Your Plots</h3>
<p>You can save your plots as follows. Please save each plot, as you will use it later. Make sure to enclose the name inside quotes and to not use spaces within the name.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="kw">ggsave</span>(<span class="st">&quot;Name_of_Plot.png&quot;</span>)</a></code></pre></div>
<p>If you save the plot as above, ggplot will use dimensions of the plot as they are on your screen. You can change this default behavior by explicitly providing size of the output plot in inches.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="kw">ggsave</span>(<span class="st">&quot;Name_of_Plot.png&quot;</span>, <span class="dt">width=</span><span class="dv">7</span>, <span class="dt">height=</span><span class="dv">5</span>)</a></code></pre></div>
<p>Of course, <code>.png</code> isn’t the only format you can save the plots in. Look at following examples:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"></a>
<a class="sourceLine" id="cb20-2" title="2"><span class="kw">ggsave</span>(<span class="st">&quot;Name_of_Plot.pdf&quot;</span>)</a>
<a class="sourceLine" id="cb20-3" title="3"></a>
<a class="sourceLine" id="cb20-4" title="4"><span class="kw">ggsave</span>(<span class="st">&quot;Name_of_Plot.jpg&quot;</span>)</a>
<a class="sourceLine" id="cb20-5" title="5"></a>
<a class="sourceLine" id="cb20-6" title="6"><span class="kw">ggsave</span>(<span class="st">&quot;Name_of_Plot.svg&quot;</span>)</a></code></pre></div>
<p><br><br></p>
<h3 id="enhancing-plot-aesthetics">2.4 Enhancing plot aesthetics</h3>
<p>In the previous plot, we used the <code>aes()</code> function to assign the two axes, but it can also take additional arguments such as color of the points (or lines). For example, we can assign colors to different types of vehicles:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="kw">ggplot</span>(<span class="dt">data=</span>mpg) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour=</span>class))</a></code></pre></div>
<center>
<img src="mpg2.png" width=550>
</center>
<p>Notice how ggplot2 not only automatically chooses colors for each vehicle class, but also draws a legend to explain color pairings. In this example, instead of assigning colors manually, we simply asked ggplot to use factors of the variable <code>class</code> to assign colors.</p>
<ul>
<li>If you wanted to assign a uniform color to all the points, it won’t then convey any information about the class of the vehicles. Your legend will also not be useful.</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"></a>
<a class="sourceLine" id="cb22-2" title="2"><span class="kw">ggplot</span>(<span class="dt">data=</span>mpg) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy), <span class="dt">colour =</span> <span class="st">&quot;darkgreen&quot;</span>)</a></code></pre></div>
<center>
<img src="mpg3.png" width=550>
</center>
<p><br><br></p>
<h3 id="using-facets">2.5 Using Facets</h3>
<p>Above, we saw adding aesthetics as one way of adding more variables to the plot. Facets is another way and particularly useful for categorical variables. In order to do this, we need to add one more layer of the grammar to our existing plot.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"></a>
<a class="sourceLine" id="cb23-2" title="2"><span class="kw">ggplot</span>(<span class="dt">data=</span>mpg) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-3" title="3"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-4" title="4"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>class, <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<center>
<img src="mpg4.png" width=600>
</center>
<p>Notice that we are not using colors here as it won’t convey any additional information. If you would stil like to color the points, add at option in as in one of the earlier plots.</p>
</body>
</html>
